<!doctype html> 
<img src=bonus.png id=bonus hidden>
<img src=coil.png id=coil hidden>
<img src=gas1.png id=gas1 hidden>
<img src=gas2.png id=gas2 hidden>
<img src=ipfs.png id=ipfs hidden>
<img src=mpl.png id=mpl hidden>
<img src=near.png id=near hidden>
<img src=pan2.png id=pan2 hidden>
<img src=pan1.png id=pan1 hidden>
<img src=play.png id=play hidden>
<img src=smoke1.png id=smoke1 hidden>
<img src=smoke2.png id=smoke2 hidden>
<img src=start.png id=start hidden>
<img src=title.png id=title hidden>
<img src=tooraw.png id=tooraw hidden>
<img src=burnt.png id=burnt hidden>
<img src=ok.png id=ok hidden>
<img src=hand.png id=hand hidden>
<img src=rules1.png id=rules1 hidden>
<img src=rules2.png id=rules2 hidden>
<img src=rules3.png id=rules3 hidden>
<img src=rules4.png id=rules4 hidden>
<img src=rules5.png id=rules5 hidden>
<img src=food1.png id=food1 hidden>
<img src=food2.png id=food2 hidden>
<img src=food3.png id=food3 hidden>
<img src=food4.png id=food4 hidden>
<img src=food5.png id=food5 hidden>
<img src=foodend1.png id=foodend1 hidden>
<img src=foodend2.png id=foodend2 hidden>
<img src=foodend3.png id=foodend3 hidden>
<img src=foodend4.png id=foodend4 hidden>
<img src=foodend5.png id=foodend5 hidden>
<body style="overflow:hidden;font-family:pangolin">.
<canvas id=a style="position:fixed;top:50%;left:50%;transform:translateX(-50%)translateY(-50%);cursor:pointer;width:100vmin;height=100vmin;">

<script>
state = 0;
white = 0;
win = 0;

onload = () => {
  W = a.width = 600;
  H = a.height = 600;
  c = a.getContext("2d");
  state = 0; // title
  draw();
}

draw = () => {

console.log(white)

  a.width ^= 0;

  // Title
  if(state == 0){
    c.drawImage(title, W/2 - 300, H/2 - 270);
    c.drawImage(play, W/2 - 100, H/2 + 130);
  }
  
  // bonus
  else if(state == 1){
    c.drawImage(bonus, W/2 - 100, H/2 - 100);
    c.drawImage(coil, W/2 - 230, H/2 - 40);
    c.drawImage(near, W/2 - 120, H/2 - 40);
    c.drawImage(ipfs, W/2 + 30, H/2 - 40);
    c.drawImage(mpl, W/2 + 140, H/2  - 40);
    c.drawImage(start, W/2 - 100, H/2 + 50);
  }
  
  // Levels
  else if(state == 2 && !white){
    //if(level == 1){
      c.drawImage(window["rules" + level], W/2 - 250, H/2 - 260);
      c.drawImage(window["gas" + anim], W/2 - 250, H/2 - 80);
      
      if(md == 0){
        c.drawImage(pan1, W/2 - 250, H/2 - 80);
        c.drawImage(window["food" + level], W/2 - 30, H/2 + 10);
        c.globalAlpha = fry / 100;
        c.drawImage(window["foodend" + level], W/2 - 30, H/2 + 10);
        c.globalAlpha = 1;
        c.drawImage(pan2, W/2 - 250, H/2 - 80);
      }
      else {
        c.drawImage(pan1, W/2 - 250, H/2 - 20);
        c.drawImage(window["food" + level], W/2 - 30, H/2 + 70);
        c.globalAlpha = fry / 200;
        c.drawImage(window["foodend" + level], W/2 - 30, H/2 + 70);
        c.globalAlpha = 1;
        c.drawImage(pan2, W/2 - 250, H/2 - 20);
        c.drawImage(window["smoke" + anim], W/2 - 300, H/2 - 100);
      }
      
      if(md && !showscore){
        timer = (new Date() - timer0);
        if(timer < 3000){
          c.font = '50px pangolin';
          c.globalAlpha = Math.max(((1 / (timer / 1000)) - 0.3), 0);
          c.fillText((timer/1000).toFixed(2) + "s", 150, 250);
          c.globalAlpha = 1;
        }
      }
      
      if(!md && released && !showscore){
        c.font = '50px pangolin';
        c.fillText((timer/1000).toFixed(2) + "s", 250, 250);
      }
      
      if(showscore){
        c.drawImage(hand, W/2 + 200, H/2 - 100);
        if(timer < 9 * 1000){
          c.drawImage(tooraw, W/2 - 100, H/2 - 100);
          win = 0;
        }
        if(timer >= 9 * 1000 && timer <= 10 * 1000){
          c.drawImage(ok, W/2 - 100, H/2 - 100);
          win = 1;
        }
        if(timer > 10 * 1000){
          c.drawImage(burnt, W/2 - 100, H/2 - 100);
          win = 0;
        }
      }
    //}
  }
}

onclick = (e) => {

  if(!showscore){
    
    X = e.pageX;
    Y = e.pageY;
    
    // Title
    if(state == 0){
      state = 1;
      draw();
    }
    
    // Rules
    else if(state == 1){
      state = 2;
      level = 2;
      fry = 0;
      released = 0;
      showscore = 0;
      draw();
    }
  }
}

md = 0;
mdtimeout = 0;
timer0 = 0;
timer = 0;
showscore = 0;

onmousedown = () => {
 if(!showscore)
   mdtimeout = setTimeout(()=>{
     md=1;
     timer0 = new Date();
   }, 34);
}


onmouseup = () => {
 if(!showscore){
   clearTimeout(mdtimeout);
   if(md) released = 1;
   timer = (new Date()) - timer0;
   md=0;
   draw();
   if(state == 2){
    setTimeout(()=>{
      showscore=1;
      setTimeout(()=>{
        white = 1;
        draw();
      }, 1700);
      
      setTimeout(()=>{
        state = 2;
        if(win == 1) level ++;
        fry = 0;
        released = 0;
        showscore = 0;
        white = 0;
        draw();
      }, 2000);
    }, 1000);
   }
 }
}

anim = 1;
setInterval(() => {
  anim = 3 - anim;
  draw();
}, 250);

fry = 0;
setInterval(()=>{
  if(state == 2 && md){
    fry ++;
    draw();
  }
},33);
</script>

<style>
@font-face {
  font-family: pangolin;
  src: url(pangolin.ttf);
}
</style>