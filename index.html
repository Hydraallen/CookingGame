<!doctype html>
<meta name="viewport" content="width=device-width, initial-scale=0.5" />
<title>IT'S TOO RAW!</title>
<img src=bonus.png id=bonus hidden>
<img src=coil.png id=coil hidden>
<img src=gas1.png id=gas1 hidden>
<img src=gas2.png id=gas2 hidden>
<img src=ipfs.png id=ipfs hidden>
<img src=mpl.png id=mpl hidden>
<img src=near.png id=near hidden>
<img src=pan2.png id=pan2 hidden>
<img src=pan1.png id=pan1 hidden>
<img src=play.png id=play hidden>
<img src=smoke1.png id=smoke1 hidden>
<img src=smoke2.png id=smoke2 hidden>
<img src=start.png id=start hidden>
<img src=title.png id=title hidden>
<img src=tooraw.png id=toorawimg hidden>
<img src=toorawburnt.png id=toorawburntimg hidden>
<img src=burnt.png id=burntimg hidden>
<img src=ok.png id=ok hidden>
<img src=hand.png id=hand hidden>
<img src=rules1.png id=rules1 hidden>
<img src=rules2.png id=rules2 hidden>
<img src=rules3.png id=rules3 hidden>
<img src=rules4.png id=rules4 hidden>
<img src=rules5.png id=rules5 hidden>
<img src=food1.png id=food1 hidden>
<img src=food2.png id=food2 hidden>
<img src=food3.png id=food3 hidden>
<img src=food4.png id=food4 hidden>
<img src=food5.png id=food5 hidden>
<img src=foodend1.png id=foodend1 hidden>
<img src=foodend2.png id=foodend2 hidden>
<img src=foodend3.png id=foodend3 hidden>
<img src=foodend4.png id=foodend4 hidden>
<img src=foodend5.png id=foodend5 hidden>
<body style="overflow:hidden;font-family:pangolin">.
<canvas id=a style="position:fixed;top:50%;left:50%;transform:translateX(-50%)translateY(-50%);cursor:pointer;width:100vmin;height=100vmin;">

<script>
state = 0;
white = 0;
win = 0;
level = 0;
fry = 0;
released = 0;
showtime = 0;
showscore = 0;
step = 0;
md = 0;
mdtimeout = 0;
timer0 = 0;
timer = 0;
ready = 0;
tooraw = 0;
burnt = 0;
waittimer = 0;

levels = [
  , // 0: no
  [{min: 9, max: 10}], // 1: 9-10s
  [{min: 5, max: 6},{min: 5, max: 6}], // 2: 2 x 5-6s
  [{min: 3, max: 3.5},{min: 3, max: 3.5},{min: 3, max: 3.5},{min: 3, max: 3.5}], // 3: 5 x 3-3.5s
  [{min: 18, max: 20}], // 4: 18-20
  [{min: 0, max: 0}], // 4: wait 15

];

variants = [
  0, // 0: no
  0, // 1: no
  0, // 2: flip (default)
  "swap", // 3: swap,
  0, // 4: no
  "wait", // 5: wait 
]

scores = [
  , // 0: no
  [], // 1
  [], // 2
  [], // 3
  [], // 4
  [], // 5
  [], // 6
  
];

onload = () => {
  W = a.width = 600;
  H = a.height = 600;
  c = a.getContext("2d");
  state = 0; // title
  draw();
}

draw = () => {

  a.width ^= 0;

  // Title
  if(state == 0){
    c.drawImage(title, W/2 - 300, H/2 - 270);
    c.drawImage(play, W/2 - 100, H/2 + 130);
  }
  
  // bonus
  else if(state == 1){
    c.drawImage(bonus, W/2 - 100, H/2 - 100);
    c.drawImage(coil, W/2 - 230, H/2 - 40);
    c.drawImage(near, W/2 - 120, H/2 - 40);
    c.drawImage(ipfs, W/2 + 30, H/2 - 40);
    c.drawImage(mpl, W/2 + 140, H/2  - 40);
    c.drawImage(start, W/2 - 100, H/2 + 50);
  }
  
  // Levels
  else if(state == 2 && !white){
    c.drawImage(window["rules" + level], W/2 - 250, H/2 - 260);
    c.drawImage(window["gas" + anim], W/2 - 250, H/2 - 80);
    
    // Idle
    if(md == 0 && !flip){
      c.drawImage(pan1, W/2 - 250, H/2 - 80);
      c.drawImage(window["food" + level], W/2 - 30, H/2 + 10 + (level == 5 ? -40 : 0));
      c.globalAlpha = fry / 100;
      c.drawImage(window["foodend" + level], W/2 - 30, H/2 + 10 + (level == 5 ? -40 : 0));
      c.globalAlpha = 1;
      c.drawImage(pan2, W/2 - 250, H/2 - 80);
    }
    
    // Pressed
    if(md && !flip) {
      c.drawImage(pan1, W/2 - 250, H/2 - 20);
      c.drawImage(window["food" + level], W/2 - 30, H/2 + 70  + (level == 5 ? -40 : 0));
      c.globalAlpha = fry / 200;
      c.drawImage(window["foodend" + level], W/2 - 30, H/2 + 70 + (level == 5 ? -40 : 0));
      c.globalAlpha = 1;
      c.drawImage(pan2, W/2 - 250, H/2 - 20);
      c.drawImage(window["smoke" + anim], W/2 - 300, H/2 - 100);
    }
    
    // 1....2.....3
    if(md && !showscore && !flip && step == 0){
      timer = (new Date() - timer0);
      if(timer < 3000){
        c.font = '50px pangolin';
        c.globalAlpha = Math.max(((1 / (timer / 1000)) - (level > 1 ? 0.5 : 0.3)), 0);
        c.fillText((timer/1000).toFixed(2), 150, 250);
        c.globalAlpha = 1;
      }
    }
    
    // Show time 
    if(showtime && !showscore && !flip){
      str = "";
      if(scores[level].length == 1) c.font = '50px pangolin';
      if(scores[level].length == 2) c.font = '40px pangolin';
      if(scores[level].length > 2) c.font = '30px pangolin';
      c.textAlign = 'center';
      for(i in scores[level]){
        str += (+i ? " + " : "") + (scores[level][i]/1000).toFixed(2)
      }
      c.fillText(str, W/2, 250);
      c.textAlign = 'start';
    }
    
    // Show score
    if(showscore && !flip){
    
      tooraw = 0;
      burnt = 0;
    
      if(level == 5){
        console.log(scores[level]);
        if(scores[level][0] > 0) burnt = 1;
        else burnt = 0;
      }
      
      else {
        for(i in scores[level]){
          if(scores[level][i] < levels[level][i].min * 1000){
            tooraw = 1;
            win = 0;
          }
          else if(scores[level][i] >= levels[level][i].min * 1000 && scores[level][i] <= levels[level][i].max * 1000){
          }
          else if(scores[level][i]  > levels[level][i].max * 1000){
            burnt = 1;
            win = 0;
          }
        }
      }
      
      if(tooraw && burnt) {
        c.drawImage(toorawburntimg, W/2 - 160, H/2 - 100);
      }
      else if(tooraw && !burnt){
        c.drawImage(toorawimg, W/2 - 100, H/2 - 100);
      }
      else if(burnt && !tooraw){
        c.drawImage(burntimg, W/2 - 100, H/2 - 100);
      }
      else if(!tooraw && !burnt) {
        win = 1;
        c.drawImage(ok, W/2 - 100, H/2 - 100);
      }

      c.drawImage(hand, W/2 + 200, H/2 - 100);
    }
    
    // flip animation (default)
    if(!md && flip && !variants[level]){
      c.drawImage(pan1, W/2 - 250, H/2 - 60);
      c.save();
      c.translate(W/2 + 110, H/2 - 30);
      c.rotate((flip-20+120)/6 + 30);
      c.drawImage(window["food" + level], 0, 0);
      c.globalAlpha = fry / 100;
      c.drawImage(window["foodend" + level], 0, 0);
      c.globalAlpha = 1;
      c.restore();
      c.drawImage(pan2, W/2 - 250, H/2 - 60);
    }
    
    // swap animation
    if(!md && flip && variants[level] == "swap"){
      c.drawImage(pan1, W/2 - 250, H/2 - 60);
      c.save();
      c.translate(W/2 + 110, H/2 - 30);
      if(flip > 9){
        c.drawImage(window["food" + level], (20-flip) * 10, -(20-flip) * 10);
        c.globalAlpha = fry / 100;
        c.drawImage(window["foodend" + level], (20-flip) * 10, -(20-flip) * 10);
      }
      if(flip <= 9){
        c.drawImage(window["food" + level], -220 + (9-flip) * 10, -90 + (9-flip) * 10);
        fry = 0;
      }
      c.globalAlpha = 1;
      c.restore();
      c.drawImage(pan2, W/2 - 250, H/2 - 60);
    }
    
  }
}

onclick = (e) => {

  if(!showtime && !white && !showscore && !flip){
    
    X = e.pageX;
    Y = e.pageY;
    
    // Title
    if(state == 0){
      state = 2;
      fry = 0;
      released = 0;
      showscore = 0;
      step = 0;
      draw();
      md = 0;
      ready = 0;
      setTimeout(()=>{ready = 1}, 200);
    }
  }
}



onmousedown = ontouchstart = () => {
 if(ready && !white && !showtime && !showscore && !flip && step < levels[level].length)
   mdtimeout = setTimeout(()=>{
     md = 1;
     timer0 = new Date();
   }, 34);
}


onmouseup = ontouchend = () => {
  if(state == 2 && !white && !showtime && !showscore && !flip && step < levels[level].length){
    clearTimeout(mdtimeout);
    if(md) released = 1;
    timer = (new Date()) - timer0 + 10;
    scores[level][step] = timer;
    md = 0;
    draw();
    step++;
    
    // Flip
    if(state == 2 && step < levels[level].length){
      flip = 20;
    }
    
    // Score
    if(state == 2 && step == levels[level].length){
      showtime = 1;
      draw();
      setTimeout(()=>{
        showscore = 1;
        draw();
      }, 1000 + scores[level].length * 500);
      
      setTimeout(()=>{
        white = 1;
        draw();
      }, 1000 + scores[level].length * 500 + 2000);
      
      setTimeout(()=>{
        state = 2;
        if(win == 1) {
          level ++;
        }
        waittimer = 0;
        fry = 0;
        released = 0;
        showtime = 0;
        showscore = 0;
        white = 0;
        md = 0;
        step = 0;
        ready = 0;
        setTimeout(()=>{ready = 1}, 200);
        draw();
      }, 1000 + scores[level].length * 500 + 2500);
    }
  }
}

oncontextmenu = (e) => {
  e.preventDefault();
  return false;
}

anim = 1;
setInterval(() => {
  anim = 3 - anim;
  draw();
}, 250);


fry = 0;
setInterval(()=>{
  if(state == 2 && md && !flip){
    fry ++;
    draw();
  }

  if(level == 5) {
  
    waittimer++;
    
    if(waittimer == 455){
    
      scores[level][0] = 0;
    
      setTimeout(()=>{
        showscore = 1;
        draw();
      }, 1000 + scores[level].length * 500);
      
      setTimeout(()=>{
        white = 1;
        draw();
      }, 1000 + scores[level].length * 500 + 2000);
      
      setTimeout(()=>{
        state = 2;
        if(win == 1) {
          level ++;
        }
        waittimer = 0;
        fry = 0;
        released = 0;
        showtime = 0;
        showscore = 0;
        white = 0;
        md = 0;
        step = 0;
        ready = 0;
        setTimeout(()=>{ready = 1}, 200);
        draw();
      }, 1000 + scores[level].length * 500 + 2500); 
    }
  }
    
    
},33);

flip = 0;
setInterval(()=>{
  if(flip > 0){
    flip--;
    if(flip == 0){ fry = variants[level] ? 0 : 10; }
    draw();
  }
},33);
</script>

<style>
@font-face {
  font-family: pangolin;
  src: url(pangolin.ttf);
}

* {
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
}
*:focus {
    outline: none !important;
}
</style>